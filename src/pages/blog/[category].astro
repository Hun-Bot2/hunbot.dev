---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE } from '../../consts';
import { getPostsByCategory, formatCategoryName, getCategoryDescription, isValidCategory } from '../../utils/blog.ts';
import FormattedDate from '../../components/FormattedDate.astro';

export async function getStaticPaths() {
  const validCategories = ['ai', 'devlog', 'review', 'misc'];
  
  return validCategories.map((category) => ({
    params: { category },
  }));
}

const { category } = Astro.params;

if (!category || !isValidCategory(category)) {
  return Astro.redirect('/blog');
}

const posts = await getPostsByCategory(category);
const categoryTitle = formatCategoryName(category);
const categoryDescription = getCategoryDescription(category);
---

<!doctype html>
<html lang="ko">
  <head>
    <BaseHead title={`${categoryTitle} - ${SITE_TITLE}`} description={categoryDescription} />
  </head>
  <body>
    <Header />

    <main class="max-w-4xl mx-auto px-4 py-10">
      <h1 class="text-2xl font-bold text-[rgb(248,249,250)] mb-2">카테고리: {categoryTitle}</h1>
      <p class="mb-8 text-[rgba(248,249,250,0.8)]">{categoryDescription} 총 {posts.length}개.</p>

      {posts.length === 0 ? (
        <p class="text-slate-600 dark:text-gray-500">아직 글이 없습니다.</p>
      ) : (
        <ul class="divide-y divide-slate-700">
          {posts.map((post) => (
            <li class="py-3">
              <a href={`/blog/${post.id}/`} class="flex items-baseline gap-3 text-[rgb(248,249,250)]">
                <time class="min-w-[7.5rem] text-sm text-[rgba(248,249,250,0.6)]"><FormattedDate date={post.data.pubDate} /></time>
                <span class="hover:underline">{post.data.title}</span>
              </a>
            </li>
          ))}
        </ul>
      )}
    </main>
    
    <Footer />
  </body>
</html>
